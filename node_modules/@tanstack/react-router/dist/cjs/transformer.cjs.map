{"version":3,"file":"transformer.cjs","sources":["../../src/transformer.ts"],"sourcesContent":["import { isPlainObject } from './utils'\n\nexport interface RouterTransformer {\n  stringify: (obj: unknown) => string\n  parse: (str: string) => unknown\n}\n\nexport const defaultTransformer: RouterTransformer = {\n  stringify: (value: any) =>\n    JSON.stringify(value, function replacer(key, value) {\n      const keyVal = this[key]\n      const transformer = transformers.find((t) => t.stringifyCondition(keyVal))\n\n      if (transformer) {\n        return transformer.stringify(keyVal)\n      }\n\n      return value\n    }),\n  parse: (value: string) =>\n    JSON.parse(value, function parser(key, value) {\n      const keyVal = this[key]\n      const transformer = transformers.find((t) => t.parseCondition(keyVal))\n\n      if (transformer) {\n        return transformer.parse(keyVal)\n      }\n\n      return value\n    }),\n}\n\nconst transformers = [\n  {\n    // Dates\n    stringifyCondition: (value: any) => value instanceof Date,\n    stringify: (value: any) => ({ $date: value.toISOString() }),\n    parseCondition: (value: any) => isPlainObject(value) && value.$date,\n    parse: (value: any) => new Date(value.$date),\n  },\n  {\n    // undefined\n    stringifyCondition: (value: any) => value === undefined,\n    stringify: () => ({ $undefined: '' }),\n    parseCondition: (value: any) =>\n      isPlainObject(value) && value.$undefined === '',\n    parse: () => undefined,\n  },\n] as const\n"],"names":["value","isPlainObject"],"mappings":";;;AAOO,MAAM,qBAAwC;AAAA,EACnD,WAAW,CAAC,UACV,KAAK,UAAU,OAAO,SAAS,SAAS,KAAKA,QAAO;AAC5C,UAAA,SAAS,KAAK,GAAG;AACjB,UAAA,cAAc,aAAa,KAAK,CAAC,MAAM,EAAE,mBAAmB,MAAM,CAAC;AAEzE,QAAI,aAAa;AACR,aAAA,YAAY,UAAU,MAAM;AAAA,IACrC;AAEOA,WAAAA;AAAAA,EAAA,CACR;AAAA,EACH,OAAO,CAAC,UACN,KAAK,MAAM,OAAO,SAAS,OAAO,KAAKA,QAAO;AACtC,UAAA,SAAS,KAAK,GAAG;AACjB,UAAA,cAAc,aAAa,KAAK,CAAC,MAAM,EAAE,eAAe,MAAM,CAAC;AAErE,QAAI,aAAa;AACR,aAAA,YAAY,MAAM,MAAM;AAAA,IACjC;AAEOA,WAAAA;AAAAA,EAAA,CACR;AACL;AAEA,MAAM,eAAe;AAAA,EACnB;AAAA;AAAA,IAEE,oBAAoB,CAAC,UAAe,iBAAiB;AAAA,IACrD,WAAW,CAAC,WAAgB,EAAE,OAAO,MAAM;IAC3C,gBAAgB,CAAC,UAAeC,MAAAA,cAAc,KAAK,KAAK,MAAM;AAAA,IAC9D,OAAO,CAAC,UAAe,IAAI,KAAK,MAAM,KAAK;AAAA,EAC7C;AAAA,EACA;AAAA;AAAA,IAEE,oBAAoB,CAAC,UAAe,UAAU;AAAA,IAC9C,WAAW,OAAO,EAAE,YAAY;IAChC,gBAAgB,CAAC,UACfA,oBAAc,KAAK,KAAK,MAAM,eAAe;AAAA,IAC/C,OAAO,MAAM;AAAA,EACf;AACF;;"}